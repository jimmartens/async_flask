<!DOCTYPE html>
<html>
  <head>
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script src="static/js/application.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
google.charts.load('current', {'packages':['gauge']});
google.charts.setOnLoadCallback(drawChart);

var chart;
var data;
var options;

var chart2;
var data2;
var options2;

function drawChart() {
  data = google.visualization.arrayToDataTable([
    ['Label', 'Value'],
    ['Grill', 80]
  ]);

  options = {
    width: 200, height: 200,
    yellowFrom:350, yellowTo: 450,
    redFrom: 450, redTo: 500,
    majorTicks: 100,
    minorTicks: 20,
    min: 0,
    max: 500
  };

  data2 = google.visualization.arrayToDataTable([
    ['Label', 'Value'],
    ['Meat', 80]
  ]);

  options2 = {
    width: 200, height: 200,
    yellowFrom:140, yellowTo: 250,
    redFrom: 250, redTo: 300,
    majorTicks: 100,
    minorTicks: 20,
    min: 0,
    max: 300
  };

  chart = new google.visualization.Gauge(document.getElementById('chart_div'));
  chart.draw(data, options);

  chart2 = new google.visualization.Gauge(document.getElementById('chart2_div'));
  chart2.draw(data2, options2);
}

$(document).ready(function(){
  //connect to the socket server.
  var socket = io.connect('http://' + document.domain + ':' + location.port + '/test');
  var numbers_received = [];

  //receive details from server
  socket.on('newnumber', function(msg) {
    console.log("Received number" + msg.number);
    //maintain a list of ten numbers
    if (numbers_received.length >= 5){
      numbers_received.shift()
    }            
    numbers_received.push(msg.number);
    numbers_string = '';

    data.setValue(0, 1, 40 + Math.round(msg.number)); 
    data2.setValue(0, 1, 40 + (Math.round(msg.number)-20));
    chart.draw(data, options); 
    chart.draw(data2, options);

    //callme(new_data,new_options);
    for (var i = 0; i < numbers_received.length; i++){
      numbers_string = numbers_string + '<p>' + numbers_received[i].toString() + '</p>';
    }
    $('#log').html(numbers_string);
  });
});
    </script>
    <style>
* {
  box-sizing: border-box;
}
.row {
  display: flex;
}
.column {
  flex: 50%;
  padding: 10px;
}
    </style>

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  </head>
  <body>
    <div class="container">
      <div class="jumbotron">
        <h1>Asynchronous Flask Communication</h1>
        <p>Modified to be a grill simulator.</p>
        <p>Based on a Random numbers generated by the Flask server will appear below, asynchronously.</p>
        <p>Original creator.<a href='https://www.shanelynn.ie/asynchronous-updates-to-a-webpage-with-flask-and-socket-io/' target='_blank'>here.</a></p>
      </div>
    </div>

    <div class="container" id="content">
      <div class="row">
        <div class="column">
          <p>Asynchronous page updates will appear here:</p>
          <h3>Number list:</h3>
        </div>
        <div class="column">
          <div class="row">
            <h3>Gauge here:</h3>
            <div id="chart_div" style="height: 120px;"></div>
            <div id="chart2_div" style="height: 120px;"></div>
          </div>
        </div>
      </div>
      <div id="log">
      </div> <!-- /#log -->
    </div>

  </body>
</html>
